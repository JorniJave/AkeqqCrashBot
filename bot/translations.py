from imports import logging

CURRENT_LANGUAGE = "ru"

TRANSLATIONS = {
    "ru": {
        "banner_title": "AkeqqBot",
        "current_date": "Текущая дата: %A, %B %d, %Y, %I:%M %p MSK",
        "info_prefix": "[ИНФО]",
        "success_prefix": "[УСПЕХ]",
        "warning_prefix": "[ПРЕДУПРЕЖДЕНИЕ]",
        "error_prefix": "[ОШИБКА]",
        "input_prefix": "[ВВОД]",
        "delete_roles": "(удаление ролей)",
        "delete_channels": "(удаление каналов)",
        "create_channels": "(создание каналов и отправка сообщений)",
        "create_role": "(создание новой роли)",
        "remove_user_roles": "(удаление ролей у пользователей)",
        "popup_title": "Работа окончена",
        "popup_message": "Скрипт завершил выполнение.",
        "stats_header": "===== СТАТИСТИКА ВЫПОЛНЕНИЯ =====",
        "stats_footer": "===== КОНЕЦ СТАТИСТИКИ =====",
        "stats_deleted_roles": "Удалено ролей: {}",
        "stats_deleted_channels": "Удалено каналов: {}",
        "stats_deleted_categories": "Удалено категорий: {}",
        "stats_removed_user_roles": "Снято ролей с пользователей: {}",
        "stats_created_channels": "Создано каналов: {}",
        "stats_created_roles": "Создано ролей: {}",
        "stats_sent_messages": "Отправлено сообщений: {}",
        "stats_renamed_guild": "Переименован сервер: {} → {}",
        "stats_changed_icon": "Изменена аватарка сервера: {}",
        "enter_token": "Введите токен Discord-бота:",
        "invalid_token_format": "Некорректный формат токена. Попробуйте снова.",
        "checking_token": "Проверка токена...",
        "valid_token": "Токен валиден",
        "invalid_token": "Некорректный токен",
        "http_error": "Ошибка HTTP {}",
        "token_check_error": "Ошибка при проверке токена: {}",
        "max_retries_429": "Достигнуто максимальное количество попыток из-за 429. Завершение.",
        "select_language": "Выберите язык (ru - русский, en - английский) [ru]:",
        "invalid_language": "Введите 'ru' или 'en'.",
        "language_selected": "Выбран язык: {}",
        "guilds_header": "===== СПИСОК СЕРВЕРОВ =====",
        "guilds_footer": "===== КОНЕЦ СПИСКА =====",
        "no_guilds": "Бот не состоит ни на одном сервере!",
        "select_guild": "Выберите сервер для работы (1-{}):",
        "invalid_guild_number": "Введите число от 1 до {}.",
        "invalid_number": "Введите корректное число.",
        "guild_selected": "Выбран сервер: {}",
        "list_guilds_error": "Ошибка при получении списка серверов: {}",
        "config_prompt": "Выберите, что делать (Y/N):",
        "remove_all_roles": "Удалить все роли на сервере (кроме @everyone)?",
        "create_bot_role": "Создать новую роль для бота?",
        "remove_user_roles": "Снять все роли с пользователей?",
        "remove_channels": "Удалить все каналы?",
        "create_channels": "Создать новые каналы и отправить сообщения?",
        "change_guild_name": "Изменить название сервера?",
        "enter_new_guild_name": "Введите новое название сервера:",
        "change_guild_icon": "Изменить аватарку сервера (только с файла)?",
        "enter_icon_path": "Введите путь к файлу аватарки (PNG/JPG):",
        "invalid_icon_file": "Не удалось открыть файл: {}",
        "channel_name": "Название каналов [auto-channel]:",
        "max_channels": "Максимальное количество каналов (1-500) [50]:",
        "invalid_channel_count": "Введите число от 1 до 500.",
        "channel_limit_warning": "Discord ограничивает сервер до 500 каналов.",
        "channel_greeting": "Введите текст, который будет отправлен в новые каналы (оставьте пустым, чтобы не отправлять):",
        "num_messages": "Сколько сообщений отправлять в каждый канал? [1, максимум 100]:",
        "invalid_message_count": "Введите число от 1 до 100.",
        "role_name": "Название роли для бота [BotAdmin]:",
        "config_selected": "Настройки выбраны.",
        "bot_config": "Настройки бота:",
        "no_permissions_roles": "Бот не имеет разрешения 'Manage Roles'. Пропуск удаления ролей.",
        "role_higher": "Пропущена роль {}: роль выше в иерархии, чем роль бота",
        "role_deleted": "Удалена роль {}",
        "role_deletion_error": "Ошибка удаления роли {}: {}",
        "roles_deleted": "Роли успешно удалены",
        "role_exists": "Роль {} уже существует",
        "role_created": "Создана роль {} на {}",
        "role_creation_error": "Ошибка создания роли: {}",
        "user_roles_removed": "Сняты роли {} с {}",
        "user_roles_error": "Ошибка снятия ролей с {}: {}",
        "user_roles_done": "Роли у пользователей успешно сняты",
        "channels_deleted": "Удалена партия каналов: {}",
        "channel_deletion_error": "Ошибка при удалении партии каналов: {}",
        "categories_deleted": "Удалена партия категорий: {}",
        "category_deletion_error": "Ошибка при удалении партии категорий: {}",
        "channels_created": "Создана партия каналов: {}",
        "channels_creation_error": "Ошибка создания партии каналов: {}",
        "message_sent_channel": "Отправлено сообщение {}/{} через channel.send в канал {}",
        "message_failed": "Не удалось отправить сообщение {}/{} в канал {}: {}",
        "spam_started_channel": "Запущен спам в канале {}",
        "spam_completed_channel": "Спам в канале {} завершён",
        "channels_and_messages_done": "Каналы и сообщения успешно созданы",
        "channels_interrupted": "Создание каналов и сообщений прервано пользователем",
        "waiting_direct_spam": "Ожидание завершения прямого спама",
        "direct_spam_completed": "Прямой спам завершён",
        "direct_spam_error": "Ошибка в прямом спаме: {}",
        "min_messages_sent": "Минимальное количество отправленных сообщений: {}",
        "parallel_tasks_start": "Запуск параллельных задач: изменение имени, иконки, удаление ролей",
        "parallel_tasks_done": "Параллельные задачи завершены",
        "parallel_tasks_error": "Ошибка параллельных задач: {}",
        "guild_icon_changed": "Аватарка сервера успешно изменена!",
        "guild_icon_error": "Ошибка смены аватарки сервера: {}",
        "guild_name_changed": "Название сервера изменено: '{}' → '{}'",
        "guild_name_error": "Ошибка смены названия сервера: {}",
        "cycle_completed": "Один цикл завершён за {} сек",
        "bot_start": "Запуск бота. Python {}",
        "bot_interrupted": "Бот прерван пользователем",
        "bot_error": "Ошибка: {}. Подробности в bot.log.",
        "bot_stopped": "Бот остановлен. Нажмите Enter...",
        "bot_shutdown": "Один цикл завершён, бот завершает работу.",
        "no_guild_selected": "Работа завершена: бот не состоит ни на одном сервере или сервер не выбран.",
        "invalid_yes_no": "Введите Y или N.",
        "429_error": "Ошибка 429 при {}. Попытка {}/{}, повтор через {} сек...",
        "429_skip": "Пропуск {} из-за 429",
        "429_message": "Ошибка 429 при {}. Попытка {}/2, ожидание {} сек...",
        "http_message_error": "Ошибка HTTP {} при {}",
        "unknown_error": "Неизвестная ошибка при {}: {}",
        "on_ready_error": "Ошибка в on_ready: {}. Подробности в bot.log.",
        "ctrl_c": "Завершение (Ctrl+C).",
        "bot_connected": "Бот успешно подключился как {}",
        "no_channels_to_delete": "Нет текстовых или голосовых каналов для удаления",
        "no_categories_to_delete": "Нет категорий для удаления",
        "channel_deletion_completed": "Удаление каналов завершено",
        "no_roles_to_delete": "Нет ролей для удаления (кроме @everyone)",
        "no_users_to_remove_roles": "Нет пользователей (не ботов) для удаления ролей",
        "incomplete_channels": "Обнаружено {} каналов с неполным количеством сообщений (ожидается {}): {}",
        "all_channels_complete": "Все каналы заполнены ожидаемым количеством сообщений",
        "select_start_mode": "Выберите способ загрузки бота:",
        "mode_1_description": "[1] Бот уже находится на сервере",
        "mode_2_description": "[2] Добавить нового бота через токен",
        "enter_mode": "Введите 1 или 2: ",
        "invalid_mode": "Пожалуйста, выберите 1 или 2",
        "invite_link_message": "Пригласите бота на сервер по этой ссылке:\n{}",
        "waiting_for_invite": "Ожидание добавления бота на сервер...",
        "bot_joined_guild": "Бот добавлен на сервер: {}",
        "config_folder_detected": "Обнаружена папка config с файлами конфигурации.",
        "available_configs": "Доступные конфиги (файлы .akqcfg):",
        "load_config_prompt": "Хотите загрузить существующий конфиг? (Y/N):",
        "select_config": "Выберите конфиг для загрузки (1-{}):",
        "invalid_config_number": "Введите число от 1 до {}.",
        "config_loaded": "Конфиг {} загружен.",
        "config_load_error": "Ошибка загрузки конфига {}: {}",
        "create_config_prompt": "Хотите создать новый конфиг? (Y/N):",
        "enter_config_name": "Введите имя для нового конфига (без расширения):",
        "invalid_config_name": "Имя конфига не должно быть пустым или содержать недопустимые символы.",
        "config_saved": "Конфиг сохранён как config/{}.akqcfg",
        "config_save_error": "Ошибка сохранения конфига: {}"
    },
    "en": {
        "banner_title": "AkeqqBot",
        "current_date": "Current date: %A, %B %d, %Y, %I:%M %p MSK",
        "info_prefix": "[INFO]",
        "success_prefix": "[SUCCESS]",
        "warning_prefix": "[WARNING]",
        "error_prefix": "[ERROR]",
        "input_prefix": "[INPUT]",
        "delete_roles": "(deleting roles)",
        "delete_channels": "(deleting channels)",
        "create_channels": "(creating channels and sending messages)",
        "create_role": "(creating new role)",
        "remove_user_roles": "(removing user roles)",
        "popup_title": "Operation Completed",
        "popup_message": "Script execution finished.",
        "stats_header": "===== EXECUTION STATISTICS =====",
        "stats_footer": "===== END OF STATISTICS =====",
        "stats_deleted_roles": "Deleted roles: {}",
        "stats_deleted_channels": "Deleted channels: {}",
        "stats_deleted_categories": "Deleted categories: {}",
        "stats_removed_user_roles": "Removed user roles: {}",
        "stats_created_channels": "Created channels: {}",
        "stats_created_roles": "Created roles: {}",
        "stats_sent_messages": "Sent messages: {}",
        "stats_renamed_guild": "Renamed server: {} → {}",
        "stats_changed_icon": "Changed server icon: {}",
        "enter_token": "Enter Discord bot token:",
        "invalid_token_format": "Invalid token format. Try again.",
        "checking_token": "Checking token...",
        "valid_token": "Token is valid",
        "invalid_token": "Invalid token",
        "http_error": "HTTP error {}",
        "token_check_error": "Error checking token: {}",
        "max_retries_429": "Maximum retries reached due to 429. Terminating.",
        "select_language": "Select language (ru - Russian, en - English) [ru]:",
        "invalid_language": "Enter 'ru' or 'en'.",
        "language_selected": "Selected language: {}",
        "guilds_header": "===== LIST OF SERVERS =====",
        "guilds_footer": "===== END OF LIST =====",
        "no_guilds": "Bot is not in any servers!",
        "select_guild": "Select server to work with (1-{}):",
        "invalid_guild_number": "Enter a number from 1 to {}.",
        "invalid_number": "Enter a valid number.",
        "guild_selected": "Selected server: {}",
        "list_guilds_error": "Error listing servers: {}",
        "config_prompt": "Select actions (Y/N):",
        "remove_all_roles": "Delete all roles on the server (except @everyone)?",
        "create_bot_role": "Create a new role for the bot?",
        "remove_user_roles": "Remove all roles from users?",
        "remove_channels": "Delete all channels?",
        "create_channels": "Create new channels and send messages?",
        "change_guild_name": "Change server name?",
        "enter_new_guild_name": "Enter new server name:",
        "change_guild_icon": "Change server icon (from file only)?",
        "enter_icon_path": "Enter path to icon file (PNG/JPG):",
        "invalid_icon_file": "Could not open file: {}",
        "channel_name": "Channel name [auto-channel]:",
        "max_channels": "Maximum number of channels (1-500) [50]:",
        "invalid_channel_count": "Enter a number from 1 to 500.",
        "channel_limit_warning": "Discord limits servers to 500 channels.",
        "channel_greeting": "Enter text to send in new channels (leave empty to skip):",
        "num_messages": "How many messages to send in each channel? [1, max 100]:",
        "invalid_message_count": "Enter a number from 1 to 100.",
        "role_name": "Role name for bot [BotAdmin]:",
        "config_selected": "Configuration selected.",
        "bot_config": "Bot configuration:",
        "no_permissions_roles": "Bot lacks 'Manage Roles' permission. Skipping role deletion.",
        "role_higher": "Skipped role {}: role is higher than bot's top role",
        "role_deleted": "Deleted role {}",
        "role_deletion_error": "Error deleting role {}: {}",
        "roles_deleted": "Roles deleted successfully",
        "role_exists": "Role {} already exists",
        "role_created": "Created role {} on {}",
        "role_creation_error": "Error creating role: {}",
        "user_roles_removed": "Removed roles {} from {}",
        "user_roles_error": "Error removing roles from {}: {}",
        "user_roles_done": "User roles removed successfully",
        "channels_deleted": "Deleted channel batch: {}",
        "channel_deletion_error": "Error deleting channel batch: {}",
        "categories_deleted": "Deleted category batch: {}",
        "category_deletion_error": "Error deleting category batch: {}",
        "channels_created": "Created channel batch: {}",
        "channels_creation_error": "Error creating channel batch: {}",
        "message_sent_channel": "Sent message {}/{} via channel.send in channel {}",
        "message_failed": "Failed to send message {}/{} in channel {}: {}",
        "spam_started_channel": "Started spamming in channel {}",
        "spam_completed_channel": "Spamming in channel {} completed",
        "channels_and_messages_done": "Channels and messages created successfully",
        "channels_interrupted": "Channel and message creation interrupted by user",
        "waiting_direct_spam": "Waiting for direct spam tasks",
        "direct_spam_completed": "Direct spam completed",
        "direct_spam_error": "Error in direct spam: {}",
        "min_messages_sent": "Minimum messages sent: {}",
        "parallel_tasks_start": "Starting parallel tasks: guild name, icon, role deletion",
        "parallel_tasks_done": "Parallel tasks completed",
        "parallel_tasks_error": "Error in parallel tasks: {}",
        "guild_icon_changed": "Server icon changed successfully!",
        "guild_icon_error": "Error changing server icon: {}",
        "guild_name_changed": "Server name changed: '{}' → '{}'",
        "guild_name_error": "Error changing server name: {}",
        "cycle_completed": "One cycle completed in {} seconds",
        "bot_start": "Starting bot. Python {}",
        "bot_interrupted": "Bot interrupted by user",
        "bot_error": "Error: {}. See bot.log for details.",
        "bot_stopped": "Bot stopped. Press Enter...",
        "bot_shutdown": "One cycle completed, bot shutting down.",
        "no_guild_selected": "Operation terminated: bot is not in any server or no server selected.",
        "invalid_yes_no": "Enter Y or N.",
        "429_error": "429 error during {}. Attempt {}/{}, retrying after {} sec...",
        "429_skip": "Skipping {} due to 429",
        "429_message": "429 error during {}. Attempt {}/2, waiting {} sec...",
        "http_message_error": "HTTP error {} during {}",
        "unknown_error": "Unknown error during {}: {}",
        "on_ready_error": "Error in on_ready: {}. See bot.log for details.",
        "ctrl_c": "Terminated (Ctrl+C).",
        "bot_connected": "Bot successfully connected as {}",
        "no_channels_to_delete": "No text or voice channels to delete",
        "no_categories_to_delete": "No categories to delete",
        "channel_deletion_completed": "Channel deletion completed",
        "no_roles_to_delete": "No roles to delete (excluding @everyone)",
        "no_users_to_remove_roles": "No non-bot users to remove roles from",
        "incomplete_channels": "Found {} channels with incomplete messages (expected {}): {}",
        "all_channels_complete": "All channels have the expected number of messages",
        "select_start_mode": "Select bot start mode:",
        "mode_1_description": "[1] Bot is already on a server",
        "mode_2_description": "[2] Add a new bot via token",
        "enter_mode": "Enter 1 or 2: ",
        "invalid_mode": "Please select 1 or 2",
        "invite_link_message": "Invite the bot to a server using this link:\n{}",
        "waiting_for_invite": "Waiting for the bot to be added to a server...",
        "bot_joined_guild": "Bot has joined the server: {}",
        "config_folder_detected": "Detected config folder with configuration files.",
        "available_configs": "Available configs (.akqcfg files):",
        "load_config_prompt": "Do you want to load an existing config? (Y/N):",
        "select_config": "Select config to load (1-{}):",
        "invalid_config_number": "Enter a number from 1 to {}.",
        "config_loaded": "Config {} loaded.",
        "config_load_error": "Error loading config {}: {}",
        "create_config_prompt": "Do you want to create a new config? (Y/N):",
        "enter_config_name": "Enter a name for the new config (without extension):",
        "invalid_config_name": "Config name must not be empty or contain invalid characters.",
        "config_saved": "Config saved as config/{}.akqcfg",
        "config_save_error": "Error saving config: {}"
    }
}

def get_translation(key, *args):
    """Получить переведённое сообщение с подстановкой аргументов."""
    message = TRANSLATIONS[CURRENT_LANGUAGE].get(key, key)
    return message.format(*args) if args else message

def select_language(c_input, c_success, c_error):
    global CURRENT_LANGUAGE
    c_input(get_translation("select_language"))
    while True:
        lang = input("> ").strip().lower() or "ru"
        if lang in ("ru", "en"):
            CURRENT_LANGUAGE = lang
            c_success(get_translation("language_selected", "Русский" if lang == "ru" else "English"))
            logging.info(f"Language selected: {lang}")
            return lang
        c_error(get_translation("invalid_language"))